import { divisions, } from '@mintlify/validation';
import { replaceSlashIndex } from '../slug/replaceSlashIndex.js';
import { checkNavAccess, isPage } from './index.js';
export function getFirstPageFromNavigation(node, userGroups, shouldCheckNavAccess = false) {
    if (!node || typeof node !== 'object')
        return undefined;
    if (isPage(node)) {
        if (shouldCheckNavAccess && userGroups && !checkNavAccess(node, userGroups)) {
            return undefined;
        }
        node.href = replaceSlashIndex(node.href);
        return node;
    }
    if ('pages' in node) {
        if ('root' in node && typeof node.root === 'object') {
            const page = getFirstPageFromNavigation(node.root, userGroups, shouldCheckNavAccess);
            if (page) {
                page.href = replaceSlashIndex(page.href);
                return page;
            }
        }
        for (const page of node.pages) {
            if (typeof page === 'object') {
                const pagePath = getFirstPageFromNavigation(page, userGroups, shouldCheckNavAccess);
                if (pagePath) {
                    pagePath.href = replaceSlashIndex(pagePath.href);
                    return pagePath;
                }
            }
        }
    }
    if ('groups' in node) {
        for (const group of node.groups) {
            if (group.hidden)
                continue;
            const page = getFirstPageFromNavigation(group, userGroups, shouldCheckNavAccess);
            if (page) {
                page.href = replaceSlashIndex(page.href);
                return page;
            }
        }
    }
    for (const key of divisions) {
        if (key in node) {
            const items = node[key];
            if (Array.isArray(items)) {
                for (const item of items) {
                    if (typeof item === 'object' && 'hidden' in item && item.hidden)
                        continue;
                    const page = getFirstPageFromNavigation(item, userGroups, shouldCheckNavAccess);
                    if (page) {
                        page.href = replaceSlashIndex(page.href);
                        return page;
                    }
                }
            }
        }
    }
    return undefined;
}
